/******************************************************************************
 * Copyright 2021 TypeFox GmbH
 * This program and the accompanying materials are made available under the
 * terms of the MIT License, which is available in the project root.
 ******************************************************************************/
import fs from 'fs-extra';
import * as path from 'path';
import { log } from './generator/util.js';
import chalk from 'chalk';
export const RelativePath = Symbol('RelativePath');
export function getFilePath(absPath, config) {
    var _a;
    const base = (_a = config[RelativePath]) !== null && _a !== void 0 ? _a : process.cwd();
    return path.relative(base, absPath);
}
export async function loadConfig(options) {
    var _a;
    let filePath;
    if (options.file) {
        filePath = path.normalize(options.file);
    }
    else {
        let defaultFile = 'langium-config.json';
        if (!fs.existsSync(defaultFile)) {
            defaultFile = 'package.json';
        }
        filePath = path.normalize(defaultFile);
    }
    const relativePath = path.dirname(filePath);
    log('log', options, `Reading config from ${chalk.white.bold(filePath)}`);
    try {
        const obj = await fs.readJson(filePath, { encoding: 'utf-8' });
        const config = path.basename(filePath) === 'package.json' ? obj.langium : obj;
        config[RelativePath] = relativePath;
        (_a = config.importExtension) !== null && _a !== void 0 ? _a : (config.importExtension = '.js');
        return config;
    }
    catch (err) {
        log('error', options, chalk.red('Failed to read config file.'), err);
        process.exit(1);
    }
}
//# sourceMappingURL=package.js.map